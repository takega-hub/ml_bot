# Стратегия оптимизации прибыльности торгового бота (Single User)

## 1. Анализ текущего состояния и узких мест

### Проблемы (до оптимизации):
1. **Статичные параметры:** Использование фиксированных 3% SL и 1.5% TP не учитывало текущую волатильность рынка. В периоды затишья TP был недостижим, а в периоды шторма SL выбивало шумом.
2. **Медленная реакция:** Интервал опроса в 120 секунд (2 минуты) был слишком долгим для скальпинга/интрадея, что приводило к пропуску идеальных точек входа и выхода.
3. **Отсутствие метрик:** Не было удобного инструмента для быстрого анализа эффективности (PnL, Drawdown, Sharpe).

## 2. Реализованные меры оптимизации

### А. Динамическое управление рисками (ATR-based TP/SL)
В файл `strategy_ml.py` внедрена логика адаптации стоп-лосса и тейк-профита на основе ATR (Average True Range):
- **Логика:** Мы нормализуем текущий ATR относительно базового (0.5% для 15m).
- **Высокая волатильность (ATR > 0.5%):** Расширяем SL и TP (до 1.5x), чтобы избежать ложных выбиваний.
- **Низкая волатильность (ATR < 0.5%):** Сужаем SL и TP (до 0.8x), чтобы забирать прибыль даже на вялом рынке.
- **Ограничения:** Коэффициент адаптации ограничен диапазоном [0.8, 1.5] для безопасности.

### Б. Ускорение исполнения (Execution Speed)
В файле `config.py` оптимизирован параметр `live_poll_seconds`:
- **Было:** 120 секунд.
- **Стало:** 15 секунд.
- **Эффект:** Бот теперь реагирует на изменения рынка в 8 раз быстрее. Для 5 активных символов это безопасно с точки зрения лимитов API Bybit (обычно 10-20 запросов в секунду разрешено, а мы делаем серию раз в 15 сек).

### В. Система мониторинга (KPI Dashboard)
Создан скрипт `scripts/monitor_performance.py`, который анализирует историю сделок и выводит ключевые метрики:
- **Win Rate (%)**
- **Profit Factor** (Gross Profit / Gross Loss)
- **Max Drawdown** (Максимальная просадка)
- **Sharpe Ratio** (Коэффициент Шарпа)
- **Avg Win / Avg Loss**

## 3. План дальнейших действий и KPI

### Краткосрочные цели (1-2 недели):
1. **Сбор статистики:** Запустить бота с новыми настройками (ATR + 15s poll) и собрать минимум 50 сделок.
2. **Анализ:** Запускать `monitor_performance.py` ежедневно.
3. **Целевые KPI:**
   - **Win Rate:** > 55%
   - **Profit Factor:** > 1.5
   - **Max Drawdown:** < 10%

### Долгосрочные улучшения:
1. **Feature Engineering:** Добавить в ML-модель данные из стакана (Order Book Imbalance) или объемы ликвидаций, если API позволяет.
2. **Ensemble Weighting:** Динамически менять веса моделей в ансамбле в зависимости от того, какая модель лучше перформит в текущем режиме рынка (тренд/флэт).

## 4. Инструкция по мониторингу
Для проверки результатов регулярно запускайте:
```bash
python scripts/monitor_performance.py
```
Это покажет актуальную картину прибыльности по всем парам.
