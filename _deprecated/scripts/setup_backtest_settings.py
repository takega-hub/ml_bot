"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –±–æ—Ç–∞ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –±—ç–∫—Ç–µ—Å—Ç–æ–º.

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞–µ—Ç/–æ–±–Ω–æ–≤–ª—è–µ—Ç risk_settings.json —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏,
–∫–æ—Ç–æ—Ä—ã–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –±—ç–∫—Ç–µ—Å—Ç—É –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç–∏ —Ç–æ—Ä–≥–æ–≤–ª–∏.
"""
import json
from pathlib import Path

def setup_backtest_settings():
    """–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –±–æ—Ç–∞ –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –±—ç–∫—Ç–µ—Å—Ç—É."""
    
    # –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É –Ω–∞—Å—Ç—Ä–æ–µ–∫
    project_root = Path(__file__).parent
    risk_settings_file = project_root / "risk_settings.json"
    
    # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –±—ç–∫—Ç–µ—Å—Ç—É
    backtest_settings = {
        # –†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏
        "base_order_usd": 100.0,  # –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—É–º–º–∞ $100 (–∫–∞–∫ –≤ –±—ç–∫—Ç–µ—Å—Ç–µ)
        "margin_pct_balance": 0.20,  # 20% (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, —Ç.–∫. base_order_usd –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–µ–µ)
        
        # TP/SL
        "stop_loss_pct": 0.01,  # –°—Ç—Ä–æ–≥–æ 1% (–∫–∞–∫ –≤ –±—ç–∫—Ç–µ—Å—Ç–µ)
        "take_profit_pct": 0.02,  # 2% (–Ω–æ –≤ –±—ç–∫—Ç–µ—Å—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π TP –æ—Ç –º–æ–¥–µ–ª–∏)
        
        # –ö–æ–º–∏—Å—Å–∏—è
        "fee_rate": 0.0006,  # 0.06% (–∫–∞–∫ –≤ –±—ç–∫—Ç–µ—Å—Ç–µ)
        
        # –û—Ç–∫–ª—é—á–∞–µ–º –≤—Å–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –±—ç–∫—Ç–µ—Å—Ç—É
        "enable_trailing_stop": False,  # –ù–ï–¢ —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø–∞ –≤ –±—ç–∫—Ç–µ—Å—Ç–µ
        "enable_partial_close": False,  # –ù–ï–¢ —á–∞—Å—Ç–∏—á–Ω–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è –≤ –±—ç–∫—Ç–µ—Å—Ç–µ
        "enable_breakeven": False,  # –ù–ï–¢ –±–µ–∑—É–±—ã—Ç–∫–∞ –≤ –±—ç–∫—Ç–µ—Å—Ç–µ
        "enable_profit_protection": False,  # –ù–ï–¢ –∑–∞—â–∏—Ç—ã –ø—Ä–∏–±—ã–ª–∏ –≤ –±—ç–∫—Ç–µ—Å—Ç–µ
        "dca_enabled": False,  # –ù–ï–¢ DCA –≤ –±—ç–∫—Ç–µ—Å—Ç–µ
        "reverse_on_strong_signal": False,  # –ù–ï–¢ —Ä–µ–≤–µ—Ä—Å–∞ –≤ –±—ç–∫—Ç–µ—Å—Ç–µ
        "enable_dynamic_position_sizing": False,  # –ù–ï–¢ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞
        
        # Long-term –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è, –Ω–æ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
        "long_term_ignore_reverse": True,
        "mid_term_tp_pct": 0.025,  # 2.5%
        "long_term_tp_pct": 0.04,  # 4%
        "long_term_sl_pct": 0.02,  # 2%
        
        # DCA –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è, —Ç.–∫. dca_enabled = False)
        "dca_drawdown_pct": 0.003,  # 0.3%
        "dca_max_adds": 2,
        "dca_min_confidence": 0.6,
        
        # Reverse –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è, —Ç.–∫. reverse_on_strong_signal = False)
        "reverse_min_confidence": 0.75,
        "reverse_min_strength": "—Å–∏–ª—å–Ω–æ–µ",
    }
    
    # –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –µ—Å–ª–∏ —Ñ–∞–π–ª –µ—Å—Ç—å
    existing_settings = {}
    if risk_settings_file.exists():
        try:
            with open(risk_settings_file, 'r', encoding='utf-8') as f:
                existing_settings = json.load(f)
            print(f"‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω—ã —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ {risk_settings_file}")
        except Exception as e:
            print(f"‚ö†Ô∏è  –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫: {e}")
            print("   –°–æ–∑–¥–∞—é –Ω–æ–≤—ã–π —Ñ–∞–π–ª —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –¥–ª—è –±—ç–∫—Ç–µ—Å—Ç–∞...")
    
    # –û–±—ä–µ–¥–∏–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–Ω–æ–≤—ã–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—é—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ)
    final_settings = {**existing_settings, **backtest_settings}
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    try:
        with open(risk_settings_file, 'w', encoding='utf-8') as f:
            json.dump(final_settings, f, indent=2, ensure_ascii=False)
        
        print(f"\n‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ {risk_settings_file}")
        print("\nüìã –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –±—ç–∫—Ç–µ—Å—Ç—É:")
        print("   ‚Ä¢ base_order_usd: 100.0 (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—É–º–º–∞ $100)")
        print("   ‚Ä¢ stop_loss_pct: 0.01 (—Å—Ç—Ä–æ–≥–æ 1%)")
        print("   ‚Ä¢ fee_rate: 0.0006 (0.06%)")
        print("   ‚Ä¢ enable_trailing_stop: False (–æ—Ç–∫–ª—é—á–µ–Ω–æ)")
        print("   ‚Ä¢ enable_partial_close: False (–æ—Ç–∫–ª—é—á–µ–Ω–æ)")
        print("   ‚Ä¢ enable_breakeven: False (–æ—Ç–∫–ª—é—á–µ–Ω–æ)")
        print("   ‚Ä¢ enable_profit_protection: False (–æ—Ç–∫–ª—é—á–µ–Ω–æ)")
        print("   ‚Ä¢ dca_enabled: False (–æ—Ç–∫–ª—é—á–µ–Ω–æ)")
        print("   ‚Ä¢ reverse_on_strong_signal: False (–æ—Ç–∫–ª—é—á–µ–Ω–æ)")
        print("   ‚Ä¢ enable_dynamic_position_sizing: False (–æ—Ç–∫–ª—é—á–µ–Ω–æ)")
        
        print("\n‚ö†Ô∏è  –í–ê–ñ–ù–û:")
        print("   1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫")
        print("   2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ confidence_threshold = 0.45 (45%)")
        print("   3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–ª–µ—á–æ = 10x")
        print("   4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ TP –±–µ—Ä–µ—Ç—Å—è –∏–∑ —Å–∏–≥–Ω–∞–ª–∞ –º–æ–¥–µ–ª–∏ (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π), –∞ –Ω–µ –∏–∑ take_profit_pct")
        print("   5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –ø–µ—Ä–≤—ã—Ö —Å–¥–µ–ª–æ–∫ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –±—ç–∫—Ç–µ—Å—Ç—É")
        
        return True
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫: {e}")
        return False


if __name__ == "__main__":
    print("=" * 80)
    print("üîß –ù–ê–°–¢–†–û–ô–ö–ê –ü–ê–†–ê–ú–ï–¢–†–û–í –ë–û–¢–ê –î–õ–Ø –°–û–û–¢–í–ï–¢–°–¢–í–ò–Ø –ë–≠–ö–¢–ï–°–¢–£")
    print("=" * 80)
    print()
    
    success = setup_backtest_settings()
    
    if success:
        print("\n" + "=" * 80)
        print("‚úÖ –ù–ê–°–¢–†–û–ô–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê")
        print("=" * 80)
    else:
        print("\n" + "=" * 80)
        print("‚ùå –û–®–ò–ë–ö–ê –ü–†–ò –ù–ê–°–¢–†–û–ô–ö–ï")
        print("=" * 80)
