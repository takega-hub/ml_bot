# ‚úÖ –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–π MTF —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ (1h + 15m)

## üìã –ß—Ç–æ –±—ã–ª–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. –ö–ª–∞—Å—Å MultiTimeframeMLStrategy (`bot/ml/mtf_strategy.py`)

–ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è, –∫–æ—Ç–æ—Ä–∞—è:
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç 1h –º–æ–¥–µ–ª—å –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–µ–Ω–¥–∞
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç 15m –º–æ–¥–µ–ª—å –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –≤—Ö–æ–¥–∞
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–≤–∞ —Ä–µ–∂–∏–º–∞: "strict" (—Å—Ç—Ä–æ–≥–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ) –∏ "weighted" (–≤–∑–≤–µ—à–µ–Ω–Ω–æ–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç 1h –¥–∞–Ω–Ω—ã–µ –∏–∑ 15m –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**
- `predict_combined()` - –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –æ–±–µ–∏—Ö –º–æ–¥–µ–ª–µ–π
- `generate_signal()` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ—Ä–≥–æ–≤–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞ —Å TP/SL

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (`bot/config.py`)

–î–æ–±–∞–≤–ª–µ–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è MTF —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:
- `use_mtf_strategy` - –≤–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å MTF —Å—Ç—Ä–∞—Ç–µ–≥–∏—é
- `mtf_confidence_threshold_1h` - –ø–æ—Ä–æ–≥ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –¥–ª—è 1h –º–æ–¥–µ–ª–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0.50)
- `mtf_confidence_threshold_15m` - –ø–æ—Ä–æ–≥ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –¥–ª—è 15m –º–æ–¥–µ–ª–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0.35)
- `mtf_alignment_mode` - —Ä–µ–∂–∏–º –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è ("strict" –∏–ª–∏ "weighted")
- `mtf_require_alignment` - —Ç—Ä–µ–±–æ–≤–∞—Ç—å —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### 3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ TradingLoop (`bot/trading_loop.py`)

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ MTF —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:
- –ê–≤—Ç–æ–ø–æ–∏—Å–∫ –º–æ–¥–µ–ª–µ–π 1h –∏ 15m –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–∏–º–≤–æ–ª–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É MTF –∏ –æ–±—ã—á–Ω–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–±–æ–∏—Ö —Ç–∏–ø–æ–≤ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –≤ –æ–¥–Ω–æ–º –±–æ—Ç–µ

### 4. –°–∫—Ä–∏–ø—Ç –±—ç–∫—Ç–µ—Å—Ç–∞ (`backtest_mtf_strategy.py`)

–ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –±—ç–∫—Ç–µ—Å—Ç –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –º–æ–¥–µ–ª–µ–π
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (–ø–æ—Ä–æ–≥–∏, —Ä–µ–∂–∏–º—ã)
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### 5. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- `MTF_STRATEGY_GUIDE.md` - –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
- `MTF_STRATEGY_IMPLEMENTATION.md` - —ç—Ç–æ—Ç —Ñ–∞–π–ª

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π

```bash
# –û–±—É—á–∏—Ç—å 1h –º–æ–¥–µ–ª–∏
python retrain_ml_optimized.py --interval 60m --no-mtf --symbol BTCUSDT

# –û–±—É—á–∏—Ç—å 15m –º–æ–¥–µ–ª–∏
python retrain_ml_optimized.py --interval 15m --no-mtf --symbol BTCUSDT
```

### 2. –í–∫–ª—é—á–µ–Ω–∏–µ MTF —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

–í `bot/config.py` –∏–ª–∏ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```python
ml_strategy = StrategyParams(
    use_mtf_strategy=True,
    mtf_confidence_threshold_1h=0.50,
    mtf_confidence_threshold_15m=0.35,
    mtf_alignment_mode="strict",
)
```

### 3. –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

```bash
python run_bot.py
```

### 4. –ë—ç–∫—Ç–µ—Å—Ç

```bash
python backtest_mtf_strategy.py --symbol BTCUSDT --days 30
```

## üìä –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### –†–µ–∂–∏–º "strict" (—Å—Ç—Ä–æ–≥–∏–π)

1. 1h –º–æ–¥–µ–ª—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–µ–Ω–¥–∞
2. –ï—Å–ª–∏ 1h –¥–∞–µ—Ç —Å–∏–≥–Ω–∞–ª ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è 15m –º–æ–¥–µ–ª—å
3. –ï—Å–ª–∏ 15m –¥–∞–µ—Ç —Ç–æ—Ç –∂–µ —Å–∏–≥–Ω–∞–ª ‚Üí –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ–∑–∏—Ü–∏—è
4. –ï—Å–ª–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç ‚Üí —Å–∏–≥–Ω–∞–ª –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è

**–ü—Ä–∏–º–µ—Ä:**
```
1h: LONG (0.65) ‚úÖ
15m: LONG (0.42) ‚úÖ
‚Üí –í—Ö–æ–¥ –≤ LONG —Å –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å—é 0.51

1h: LONG (0.60) ‚úÖ
15m: SHORT (0.45) ‚ùå
‚Üí –°–∏–≥–Ω–∞–ª –æ—Ç–∫–ª–æ–Ω–µ–Ω (–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç)
```

### –†–µ–∂–∏–º "weighted" (–≤–∑–≤–µ—à–µ–Ω–Ω—ã–π)

1. –û–±–µ –º–æ–¥–µ–ª–∏ –¥–∞—é—Ç –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è
2. –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å = 0.4 √ó conf_1h + 0.6 √ó conf_15m
3. –ü—Ä–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–æ–ª–µ–µ —É–≤–µ—Ä–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

MTF —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç 1h –¥–∞–Ω–Ω—ã–µ –∏–∑ 15m:
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `resample("60min")` –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏
- –ê–≥—Ä–µ–≥–∏—Ä—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ OHLCV –∫–æ–ª–æ–Ω–∫–∏
- –ê–≥—Ä–µ–≥–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–Ω—É—Ç—Ä–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –ø—Ä–∏ `df_1h=None`

### –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

- –ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–º–µ—Å—Ç–∏–º–∞ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ (MTF –∏–ª–∏ –æ–±—ã—á–Ω–∞—è)
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –¥—Ä—É–≥–∏—Ö —á–∞—Å—Ç—è—Ö —Å–∏—Å—Ç–µ–º—ã

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- –ê–≥—Ä–µ–≥–∞—Ü–∏—è 1h –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è (–∞–≥—Ä–µ–≥–∞—Ü–∏—è –±—ã—Å—Ç—Ä–∞—è)
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –æ–±—ã—á–Ω–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π

## üìà –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ª–æ–∂–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤** - 1h –º–æ–¥–µ–ª—å –æ—Ç—Å–µ–∫–∞–µ—Ç —à—É–º
2. **–¢–æ—á–Ω—ã–µ –≤—Ö–æ–¥—ã** - 15m –º–æ–¥–µ–ª—å –¥–∞–µ—Ç –ª—É—á—à–∏–π —Ç–∞–π–º–∏–Ω–≥
3. **–ü–æ–≤—ã—à–µ–Ω–∏–µ Win Rate** - –≤—Ö–æ–¥ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π
4. **–ì–∏–±–∫–æ—Å—Ç—å** - –¥–≤–∞ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã (strict/weighted)

## ‚ö†Ô∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- –û–±—É—á–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ –¥–ª—è –æ–±–æ–∏—Ö —Ç–∞–π–º—Ñ—Ä–µ–π–º–æ–≤ (1h –∏ 15m)
- –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ 1h (–º–∏–Ω–∏–º—É–º 4 —Å–≤–µ—á–∏ 15m = 1 —Å–≤–µ—á–∞ 1h)

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ë–∞–∑–æ–≤—ã–π —Ç–µ—Å—Ç
python backtest_mtf_strategy.py --symbol BTCUSDT --days 30

# –° –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
python backtest_mtf_strategy.py --symbol ETHUSDT --days 60 --conf-1h 0.60 --conf-15m 0.40

# –í–∑–≤–µ—à–µ–Ω–Ω—ã–π —Ä–µ–∂–∏–º
python backtest_mtf_strategy.py --symbol SOLUSDT --days 30 --alignment-mode weighted
```

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —Å–∏–º–≤–æ–ª–∞—Ö
2. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Ä–æ–≥–∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–∏–º–≤–æ–ª–∞
3. –°—Ä–∞–≤–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º–∏
4. –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ 4h –º–æ–¥–µ–ª–∏ –∫–∞–∫ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ñ–∏–ª—å—Ç—Ä–∞

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `bot/ml/mtf_strategy.py` - –æ—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
- `bot/config.py` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- `bot/trading_loop.py` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ —Ç–æ—Ä–≥–æ–≤—ã–π —Ü–∏–∫–ª
- `backtest_mtf_strategy.py` - —Å–∫—Ä–∏–ø—Ç –±—ç–∫—Ç–µ—Å—Ç–∞
- `MTF_STRATEGY_GUIDE.md` - –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
