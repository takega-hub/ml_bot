# Ð£Ð»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ñ compare_ml_models.py

## âœ… Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð½Ñ‹Ðµ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸

### 1. Ð Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð½Ñ‹Ð¹ ÑÐ±Ð¾Ñ€ Ð¼ÐµÑ‚Ñ€Ð¸Ðº
- Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ñ‹ Ð²ÑÐµ Ð¼ÐµÑ‚Ñ€Ð¸ÐºÐ¸ Ð¸Ð· `BacktestMetrics`:
  - `sortino_ratio`, `calmar_ratio`
  - `total_signals`, `avg_mfe`, `avg_mae`, `mfe_mae_ratio`
  - `var_95`, `cvar_95`
  - `recovery_factor`, `expectancy_usd`
  - `risk_reward_ratio`, `trade_frequency_per_day`
  - `profitable_days_pct`, `ulcer_index`, `kelly_criterion`
  - `avg_tp_distance_pct`, `avg_sl_distance_pct`, `avg_rr_ratio`
  - `signal_quality_score`
  - `signals_with_tp_sl_pct`, `signals_with_correct_sl_pct`
  - `avg_position_size_usd`

### 2. Ð”ÐµÑ‚Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð°Ð½Ð°Ð»Ð¸Ð· (`--detailed-analysis`)

#### ÐÐ½Ð°Ð»Ð¸Ð· Ñ€Ð°ÑÐ¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ñ ÑÐ¸Ð³Ð½Ð°Ð»Ð¾Ð²
- % LONG ÑÐ¸Ð³Ð½Ð°Ð»Ð¾Ð²
- % SHORT ÑÐ¸Ð³Ð½Ð°Ð»Ð¾Ð²
- % HOLD ÑÐ¸Ð³Ð½Ð°Ð»Ð¾Ð²
- Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ ÑÐ¸Ð³Ð½Ð°Ð»Ð¾Ð² (ÐºÐ¾Ð½Ð²ÐµÑ€ÑÐ¸Ñ Ð² ÑÐ´ÐµÐ»ÐºÐ¸)
- Ð‘Ð°Ð»Ð°Ð½Ñ LONG/SHORT

#### ÐÐ½Ð°Ð»Ð¸Ð· ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ð° ÑÐ¸Ð³Ð½Ð°Ð»Ð¾Ð²
- % ÑÐ¸Ð³Ð½Ð°Ð»Ð¾Ð² Ñ TP/SL
- % ÑÐ¸Ð³Ð½Ð°Ð»Ð¾Ð² Ñ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ð¼ SL (1%)
- ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ð° (Poor/Fair/Good/Excellent)

#### ÐÐ½Ð°Ð»Ð¸Ð· ÑÑ„Ñ„ÐµÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚Ð¸ TP/SL
- Ð¡Ñ€ÐµÐ´Ð½ÐµÐµ Ñ€Ð°ÑÑÑ‚Ð¾ÑÐ½Ð¸Ðµ Ð´Ð¾ TP
- Ð¡Ñ€ÐµÐ´Ð½ÐµÐµ Ñ€Ð°ÑÑÑ‚Ð¾ÑÐ½Ð¸Ðµ Ð´Ð¾ SL
- TP/SL ratio
- Ð­Ñ„Ñ„ÐµÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ Ñ€Ð¸ÑÐº/Ð¿Ñ€Ð¸Ð±Ñ‹Ð»ÑŒ

#### ÐÐ½Ð°Ð»Ð¸Ð· ÐºÐ¾Ð½Ð²ÐµÑ€ÑÐ¸Ð¸ ÑÐ¸Ð³Ð½Ð°Ð»Ð¾Ð²
- ÐšÐ¾Ð½Ð²ÐµÑ€ÑÐ¸Ñ ÑÐ¸Ð³Ð½Ð°Ð» â†’ ÑÐ´ÐµÐ»ÐºÐ°
- ÐŸÐ¾ ÐºÐ°Ð¶Ð´Ð¾Ð¼Ñƒ ÑÐ¸Ð¼Ð²Ð¾Ð»Ñƒ Ð¾Ñ‚Ð´ÐµÐ»ÑŒÐ½Ð¾

#### ÐÐ½Ð°Ð»Ð¸Ð· ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»Ñ ÑÐ´ÐµÐ»Ð¾Ðº
- MFE/MAE ratio
- ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»Ñ (Poor/Fair/Good/Excellent)

#### Ð¢Ð¾Ð¿-5 Ð¼Ð¾Ð´ÐµÐ»ÐµÐ¹ Ð¿Ð¾ Ð¼ÐµÑ‚Ñ€Ð¸ÐºÐ°Ð¼
- PnL %
- Win Rate %
- Profit Factor
- Sharpe Ratio
- Composite Score

### 3. Ð¡Ñ€Ð°Ð²Ð½ÐµÐ½Ð¸Ðµ Ñ Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰Ð¸Ð¼Ð¸ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð°Ð¼Ð¸ (`--compare-with`)

- Ð¡Ñ€Ð°Ð²Ð½ÐµÐ½Ð¸Ðµ PnL% (Ð´Ð¾/Ð¿Ð¾ÑÐ»Ðµ)
- Ð¡Ñ€Ð°Ð²Ð½ÐµÐ½Ð¸Ðµ Win Rate (Ð´Ð¾/Ð¿Ð¾ÑÐ»Ðµ)
- Ð¡Ñ€Ð°Ð²Ð½ÐµÐ½Ð¸Ðµ Profit Factor (Ð´Ð¾/Ð¿Ð¾ÑÐ»Ðµ)
- Ð¡Ñ€Ð°Ð²Ð½ÐµÐ½Ð¸Ðµ Max Drawdown (Ð´Ð¾/Ð¿Ð¾ÑÐ»Ðµ)
- ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ ÑƒÐ»ÑƒÑ‡ÑˆÐµÐ½Ð½Ñ‹Ñ… Ð¼Ð¾Ð´ÐµÐ»ÐµÐ¹
- Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹

### 4. ÐÐ¾Ð²Ñ‹Ðµ Ð²Ñ‹Ñ‡Ð¸ÑÐ»ÑÐµÐ¼Ñ‹Ðµ Ð¼ÐµÑ‚Ñ€Ð¸ÐºÐ¸

- `signal_utilization_pct` - Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ ÑÐ¸Ð³Ð½Ð°Ð»Ð¾Ð²
- `long_short_balance` - Ð±Ð°Ð»Ð°Ð½Ñ LONG/SHORT
- `signal_quality` - ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ð° ÑÐ¸Ð³Ð½Ð°Ð»Ð¾Ð²
- `tp_sl_ratio` - ÑÐ¾Ð¾Ñ‚Ð½Ð¾ÑˆÐµÐ½Ð¸Ðµ TP/SL
- `risk_reward_efficiency` - ÑÑ„Ñ„ÐµÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ Ñ€Ð¸ÑÐº/Ð¿Ñ€Ð¸Ð±Ñ‹Ð»ÑŒ
- `signal_to_trade_ratio` - ÐºÐ¾Ð½Ð²ÐµÑ€ÑÐ¸Ñ ÑÐ¸Ð³Ð½Ð°Ð»Ð¾Ð²
- `trade_control` - ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÑŒ ÑÐ´ÐµÐ»Ð¾Ðº (MFE/MAE)
- `trade_control_category` - ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»Ñ

## ðŸ“Š Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ

### Ð‘Ð°Ð·Ð¾Ð²Ð¾Ðµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¿Ð¾ÑÐ»Ðµ Ð¿ÐµÑ€ÐµÐ¾Ð±ÑƒÑ‡ÐµÐ½Ð¸Ñ

```bash
python compare_ml_models.py --detailed-analysis
```

### Ð¡Ñ€Ð°Ð²Ð½ÐµÐ½Ð¸Ðµ Ð´Ð¾/Ð¿Ð¾ÑÐ»Ðµ Ð¿ÐµÑ€ÐµÐ¾Ð±ÑƒÑ‡ÐµÐ½Ð¸Ñ

```bash
# 1. Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ð”Ðž
python compare_ml_models.py --output csv

# 2. ÐŸÐµÑ€ÐµÐ¾Ð±ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð¼Ð¾Ð´ÐµÐ»Ð¸
python retrain_ml_optimized.py

# 3. Ð¡Ñ€Ð°Ð²Ð½Ð¸Ñ‚ÑŒ Ñ Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰Ð¸Ð¼Ð¸
python compare_ml_models.py \
    --compare-with ml_models_comparison_20260206_100000.csv \
    --detailed-analysis
```

### ÐŸÐ¾Ð»Ð½Ñ‹Ð¹ Ð°Ð½Ð°Ð»Ð¸Ð·

```bash
python compare_ml_models.py \
    --output all \
    --detailed-analysis \
    --check-overfitting \
    --compare-with previous_results.csv
```

## ðŸ“ˆ Ð§Ñ‚Ð¾ Ð°Ð½Ð°Ð»Ð¸Ð·Ð¸Ñ€ÑƒÐµÑ‚ÑÑ

### Ð‘Ð°Ð·Ð¾Ð²Ñ‹Ðµ Ð¼ÐµÑ‚Ñ€Ð¸ÐºÐ¸ (Ð²ÑÐµÐ³Ð´Ð°)
- Total PnL (USD Ð¸ %)
- Win Rate
- Profit Factor
- Max Drawdown
- Sharpe/Sortino/Calmar Ratios
- Composite Score

### Ð”ÐµÑ‚Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð°Ð½Ð°Ð»Ð¸Ð· (--detailed-analysis)
- Ð Ð°ÑÐ¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ ÑÐ¸Ð³Ð½Ð°Ð»Ð¾Ð² (LONG/SHORT/HOLD)
- ÐšÐ°Ñ‡ÐµÑÑ‚Ð²Ð¾ ÑÐ¸Ð³Ð½Ð°Ð»Ð¾Ð² (TP/SL)
- Ð­Ñ„Ñ„ÐµÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ TP/SL
- ÐšÐ¾Ð½Ð²ÐµÑ€ÑÐ¸Ñ ÑÐ¸Ð³Ð½Ð°Ð»Ð¾Ð²
- ÐšÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÑŒ ÑÐ´ÐµÐ»Ð¾Ðº (MFE/MAE)
- Ð¢Ð¾Ð¿-5 Ð¼Ð¾Ð´ÐµÐ»ÐµÐ¹ Ð¿Ð¾ Ð¼ÐµÑ‚Ñ€Ð¸ÐºÐ°Ð¼

### Ð¡Ñ€Ð°Ð²Ð½ÐµÐ½Ð¸Ðµ (--compare-with)
- Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ PnL%, Win Rate, Profit Factor, Max Drawdown
- Ð¤Ð»Ð°Ð³ ÑƒÐ»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ñ Ð¼Ð¾Ð´ÐµÐ»Ð¸
- Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹

## ðŸ“ Ð’Ñ‹Ñ…Ð¾Ð´Ð½Ñ‹Ðµ Ñ„Ð°Ð¹Ð»Ñ‹

1. **CSV Ñ„Ð°Ð¹Ð»**: `ml_models_comparison_YYYYMMDD_HHMMSS.csv`
   - ÐŸÐ¾Ð»Ð½Ð°Ñ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ð° ÑÐ¾ Ð²ÑÐµÐ¼Ð¸ Ð¼ÐµÑ‚Ñ€Ð¸ÐºÐ°Ð¼Ð¸
   - Ð’ÑÐµ Ð´Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð²Ñ‹Ñ‡Ð¸ÑÐ»ÑÐµÐ¼Ñ‹Ðµ Ð¼ÐµÑ‚Ñ€Ð¸ÐºÐ¸

2. **Ð“Ñ€Ð°Ñ„Ð¸ÐºÐ¸** (--output plots|all):
   - `heatmap_pnl.png` - Ð¢ÐµÐ¿Ð»Ð¾Ð²Ð°Ñ ÐºÐ°Ñ€Ñ‚Ð° Ð´Ð¾Ñ…Ð¾Ð´Ð½Ð¾ÑÑ‚Ð¸
   - `risk_return.png` - Ð Ð¸ÑÐº vs Ð´Ð¾Ñ…Ð¾Ð´Ð½Ð¾ÑÑ‚ÑŒ
   - `top_models.png` - Ð¢Ð¾Ð¿-10 Ð¼Ð¾Ð´ÐµÐ»ÐµÐ¹
   - `correlation_matrix.png` - ÐšÐ¾Ñ€Ñ€ÐµÐ»ÑÑ†Ð¸Ñ Ð¼ÐµÑ‚Ñ€Ð¸Ðº

3. **JSON Ð¾Ñ‚Ñ‡ÐµÑ‚** (--output all):
   - ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ Ð·Ð°Ð¿ÑƒÑÐºÐ°
   - Ð¡Ð²Ð¾Ð´Ð½Ð°Ñ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ°
   - Ð›ÑƒÑ‡ÑˆÐ¸Ðµ Ð¼Ð¾Ð´ÐµÐ»Ð¸
   - Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¸

## ðŸ’¡ Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¸

1. **ÐŸÐ¾ÑÐ»Ðµ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ Ð¿ÐµÑ€ÐµÐ¾Ð±ÑƒÑ‡ÐµÐ½Ð¸Ñ** Ð·Ð°Ð¿ÑƒÑÐºÐ°Ð¹Ñ‚Ðµ Ñ `--detailed-analysis`
2. **Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐ¹Ñ‚Ðµ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹** Ð¿ÐµÑ€ÐµÐ´ Ð¿ÐµÑ€ÐµÐ¾Ð±ÑƒÑ‡ÐµÐ½Ð¸ÐµÐ¼ Ð´Ð»Ñ ÑÑ€Ð°Ð²Ð½ÐµÐ½Ð¸Ñ
3. **Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ `--compare-with`** Ð´Ð»Ñ Ð¾Ñ‚ÑÐ»ÐµÐ¶Ð¸Ð²Ð°Ð½Ð¸Ñ ÑƒÐ»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ð¹
4. **ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐ¹Ñ‚Ðµ Ð½Ð° Ð¿ÐµÑ€ÐµÐ¾Ð±ÑƒÑ‡ÐµÐ½Ð¸Ðµ** Ñ `--check-overfitting`

## ðŸ” Ð˜Ð½Ñ‚ÐµÑ€Ð¿Ñ€ÐµÑ‚Ð°Ñ†Ð¸Ñ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð¾Ð²

### Ð¥Ð¾Ñ€Ð¾ÑˆÐ¸Ðµ Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚ÐµÐ»Ð¸
- Win Rate > 50%
- Profit Factor > 1.5
- Sharpe Ratio > 1.0
- Max Drawdown < 15%
- Signal Utilization > 20%
- Signals with TP/SL > 90%
- Trade Control > 1.0

### ÐŸÐ»Ð¾Ñ…Ð¸Ðµ Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚ÐµÐ»Ð¸
- Win Rate < 45%
- Profit Factor < 1.0
- Max Drawdown > 25%
- Signal Utilization < 5%
- Trade Control < 0.5

## âš ï¸ Ð’Ð°Ð¶Ð½Ð¾

- Ð’ÑÐµ Ð¼ÐµÑ‚Ñ€Ð¸ÐºÐ¸ Ñ‚ÐµÐ¿ÐµÑ€ÑŒ ÑÐ¾Ð±Ð¸Ñ€Ð°ÑŽÑ‚ÑÑ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸
- Ð”ÐµÑ‚Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð°Ð½Ð°Ð»Ð¸Ð· Ð¿Ð¾Ð¼Ð¾Ð³Ð°ÐµÑ‚ Ð¿Ð¾Ð½ÑÑ‚ÑŒ, Ð¿Ð¾Ñ‡ÐµÐ¼Ñƒ Ð¼Ð¾Ð´ÐµÐ»ÑŒ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ñ…Ð¾Ñ€Ð¾ÑˆÐ¾/Ð¿Ð»Ð¾Ñ…Ð¾
- Ð¡Ñ€Ð°Ð²Ð½ÐµÐ½Ð¸Ðµ Ñ Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰Ð¸Ð¼Ð¸ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð°Ð¼Ð¸ Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ ÑÑ„Ñ„ÐµÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ ÑƒÐ»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ð¹
- Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Ð´Ð»Ñ Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ð¸ Ð¿Ð¾ÑÐ»Ðµ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ Ð¿ÐµÑ€ÐµÐ¾Ð±ÑƒÑ‡ÐµÐ½Ð¸Ñ
